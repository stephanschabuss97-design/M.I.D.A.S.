<!DOCTYPE html>
<!-- MODULE: BOOTSTRAP & CONSTANTS
  intent: HTML-Grundgeruest, Meta-Bootstrap, Basis-Themetokens fuer den Monolithen
  contracts: definiert Head-Struktur, laedt globale Styles, bereitet Container fuer nachgelagerte Module vor
  notes: Kommentarpflege; Markup fuer W3C-Compliance unveraendert lassen
-->
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net; style-src 'self'; connect-src 'self' https://*.supabase.co wss://*.supabase.co; img-src 'self' data:; font-src 'self' data:; media-src 'self' blob:; object-src 'none'; manifest-src 'self'; worker-src 'self'; base-uri 'self';">
  <meta name="theme-color" content="#121417">
  <title>Medical Incident and Data Analysis Software</title>
  <link rel="stylesheet" href="app/app.css">
  <link rel="manifest" href="public/manifest.json">
  <!-- END MODULE -->
</head>
<body data-boot-stage="boot" aria-busy="true">
  <div
    id="bootScreen"
    class="boot-screen"
    role="status"
    aria-live="polite"
  >
    <div class="boot-screen__inner">
      <p class="boot-stage-label" data-boot-stage-label>Boot</p>
      <p class="boot-stage-desc">MIDAS startet gleich ...</p>
      <div
        id="bootErrorPanel"
        class="boot-error-panel"
        role="alert"
        aria-live="assertive"
        hidden
        aria-hidden="true"
      >
        <p class="boot-error-title">Boot fehlgeschlagen</p>
        <p class="boot-error-text" id="bootErrorMessage">Ein Fehler blockiert den Start.</p>
        <p class="boot-error-detail" id="bootErrorDetail">Details folgen, sobald Touch-Log verf&uuml;gbar ist.</p>
        <button id="bootErrorDiagBtn" type="button" class="btn ghost">
          Touch-Log &ouml;ffnen
        </button>
      </div>
    </div>
  </div>
  <!-- ANKER: touch-log-fallback -->
  <pre id="touchLog" class="u-diag-log"></pre>
  <header></header>
  <!-- Diagnose-Panel -->
  <div id="diag" class="panel" role="dialog" aria-modal="false" aria-labelledby="diagTitle">
    <header>
      <h4 id="diagTitle">Touch-Log</h4>
      <button class="btn ghost" id="diagClose" type="button">x</button>
    </header>
    <pre id="diagLog" class="content u-m-0"></pre>
  </div>
  <!-- Placeholder help panel to satisfy ui-core init (no visible toggle yet) -->
  <div
    id="help"
    class="panel"
    role="dialog"
    aria-modal="false"
    aria-labelledby="helpTitle"
    hidden
    aria-hidden="true"
  >
    <header>
      <h4 id="helpTitle">Hilfe</h4>
      <button class="btn ghost" id="helpClose" type="button" aria-label="Hilfe schliessen">x</button>
    </header>
    <div class="content small u-m-0">
      Hilfe-Inhalt folgt in einer spaeteren Version.
    </div>
  </div>
  <button id="helpToggle" type="button" hidden aria-hidden="true" tabindex="-1"></button>
  <div
    id="offlineBanner"
    class="offline-banner"
    role="status"
    aria-live="polite"
    hidden
    aria-hidden="true"
  >
    <div class="offline-banner__label">Offline-Modus aktiv.</div>
    <div class="offline-banner__hint">Daten werden synchronisiert, sobald die Verbindung zurueck ist.</div>
  </div>
  <div
    id="updateBanner"
    class="update-banner"
    role="status"
    aria-live="polite"
    hidden
    aria-hidden="true"
  >
    <div class="update-banner__text">
      <div class="update-banner__label">Update verfuegbar.</div>
      <div class="update-banner__hint" id="updateBannerHint">Neu laden, um die aktuelle Version zu nutzen.</div>
    </div>
    <button id="updateReloadBtn" type="button" class="btn primary">Neu laden</button>
  </div>
  <div
    id="installBanner"
    class="install-banner"
    role="status"
    aria-live="polite"
    hidden
    aria-hidden="true"
  >
    <div class="install-banner__text">
      <div class="install-banner__label">App installieren</div>
      <div class="install-banner__hint">MIDAS als App installieren fuer schnelleren Zugriff.</div>
    </div>
    <button id="installBtn" type="button" class="btn ghost">Installieren</button>
  </div>
  <!-- Diagramm-Panel (Daily) -->
  <div id="chart" class="panel chart" role="dialog" aria-modal="false" aria-labelledby="chartTitle">
    <header>
      <h4 id="chartTitle">Diagramm (Daily)</h4>
      <button class="btn ghost" id="chartClose" type="button">x</button>
    </header>
    <div class="content">
      <div class="controls">
        <select id="metricSel" class="half compact" aria-label="Messgr√∂sse ausw√§hlen">
          <option value="bp">Blutdruck (Sys/Dia)</option>
          <option value="weight">K√∂rper</option>
        </select>
        <!-- ANKER: chart-averages (Daily) -->
        <div id="chartAverages" class="kpis" aria-live="polite">
          <span data-k="sys">Durchschnitt Sys: -</span>
          <span class="sep" aria-hidden="true">*</span>
          <span data-k="dia">Durchschnitt Dia: -</span>
          <span class="sep" aria-hidden="true">*</span>
          <span data-k="map">Durchschnitt MAP: -</span>
        </div>
      </div>
      <svg id="chartSvg" viewBox="0 0 640 280" preserveAspectRatio="none" role="img" aria-label="Werteverlauf"></svg>
      <div class="legend" id="chartLegend"></div>
      <div class="small u-opacity70-mt6">Zeitraum: nutzt die <em>Arzt-Ansicht</em> (von/bis).</div>
    </div>
  </div>
  <!-- Doctor Inbox Overlay -->
  <div
    id="doctorInboxPanel"
    class="panel doctor-inbox-panel"
    role="dialog"
    aria-modal="false"
    aria-labelledby="doctorInboxTitle"
    hidden
    aria-hidden="true"
    inert
  >
    <header>
      <h4 id="doctorInboxTitle">Monatsberichte (Inbox)</h4>
      <button
        class="btn ghost"
        id="doctorInboxClose"
        type="button"
        aria-label="Fenster schliessen"
      >
        &times;
      </button>
    </header>
    <div class="content">
      <section class="card doctor-panel">
        <header class="doctor-inbox-header small u-mb-4">
          <div id="doctorInboxRange">Zeitraum: -</div>
          <div class="doctor-inbox-actions">
            <div class="muted" id="doctorInboxCount"></div>
            <button class="btn ghost" type="button" id="doctorInboxNewReportBtn">
              Neuen Monatsbericht
            </button>
            <button class="btn ghost" type="button" id="doctorInboxNewRangeReportBtn">
              Neuen Arzt-Bericht
            </button>
            <button class="btn ghost" type="button" id="doctorInboxClearBtn">
              Inbox l√∂schen
            </button>
          </div>
        </header>
        <div class="doctor-inbox-filters" role="tablist" aria-label="Report Filter">
          <button class="btn ghost is-active" type="button" data-report-filter="all" aria-selected="true">Alle</button>
          <button class="btn ghost" type="button" data-report-filter="monthly_report" aria-selected="false">Monatsberichte</button>
          <button class="btn ghost" type="button" data-report-filter="range_report" aria-selected="false">Arzt-Berichte</button>
        </div>
        <div class="doctor-inbox" id="doctorInboxList">
          <div class="small u-doctor-placeholder">Monatsberichte werden geladen ...</div>
        </div>
      </section>
    </div>
  </div>
  <div id="err" role="status" aria-live="polite"></div>
  <div id="busy"><div class="box"> Bitte warten...</div></div>
  <main id="appMain">
    <!-- HUB / MIDAS-Orbit -->
    <section class="hub" id="captureHub" aria-labelledby="hubTitle">
      <div class="hub-hero">
        <div class="hub-orbit">
          <div class="hub-orb" data-state="idle">
            <!-- 1. Aura-Layer (Blau/Magenta, drehend) -->
            <div class="midas-aura-flow" aria-hidden="true"></div>
            <!-- 2. Stern-Background -->
            <img
              class="hub-orb-bg"
              src="assets/img/midas_background_v1.PNG"
              alt="MIDAS Orb Hintergrund"
            >
            <!-- 3. Goldener Innenring -->
            <div class="midas-ring-gold" aria-hidden="true"></div>
            <!-- 4. Living Aura Canvas (optional) -->
            <canvas
              id="hubAuraCanvas"
              class="hub-aura-canvas"
              aria-hidden="true"
            ></canvas>
            <!-- 4. MIDAS-Logo im Vordergrund -->
            <img
              class="hub-orb-fg"
              src="assets/img/Idle_state.png"
              alt="MIDAS Orb Zustand"
            >
        </div>
          <div class="hub-orbit-icons" role="toolbar" aria-label="Module navigation">
            <div class="hub-carousel">
              <button
                type="button"
                class="hub-icon"
                data-hub-module="intake"
                data-carousel-id="intake"
                aria-pressed="false"
              >
              <img
                class="hub-icon-img"
                src="assets/img/Intakes_v2.png"
                alt=""
                aria-hidden="true"
              >
              <span class="sr-only">Intakes</span>
            </button>
              <button
                type="button"
                class="hub-icon"
                data-hub-module="vitals"
                data-carousel-id="vitals"
                aria-pressed="false"
              >
              <img
                class="hub-icon-img"
                src="assets/img/Vitals_v2.png"
                alt=""
                aria-hidden="true"
              >
              <span class="sr-only">Vitals</span>
            </button>
              <button
                type="button"
                class="hub-icon"
                data-hub-module="appointments"
                data-carousel-id="appointments"
                aria-pressed="false"
              >
              <img
                class="hub-icon-img"
                src="assets/img/Appointments_v2.png"
                alt=""
                aria-hidden="true"
              >
              <span class="sr-only">Termine</span>
            </button>
              <button
                type="button"
                class="hub-icon"
                data-hub-module="assistant-text"
                data-carousel-id="assistant-text"
                aria-pressed="false"
              >
              <img
                class="hub-icon-img"
                src="assets/img/Text_chat_v2.png"
                alt=""
                aria-hidden="true"
              >
              <span class="sr-only">Assistant Text Chat</span>
            </button>
            <!-- Voice parked (legacy): assistant-voice button -->
            <!--
              <button
                type="button"
                class="hub-icon"
                data-hub-module="assistant-voice"
                data-carousel-id="assistant-voice"
                aria-pressed="false"
              >
              <img
                class="hub-icon-img"
                src="assets/img/Voice_chat_v2.png"
                alt=""
                aria-hidden="true"
              >
              <span class="sr-only">Voice Chat</span>
            </button>
            -->
              <button
                type="button"
                class="hub-icon"
                data-hub-module="doctor"
                data-carousel-id="doctor"
                aria-pressed="false"
              >
              <img
                class="hub-icon-img"
                src="assets/img/Doctor_view_v2.png"
                alt=""
                aria-hidden="true"
              >
              <span class="sr-only">Arzt-Ansicht</span>
            </button>
              <button
                type="button"
                class="hub-icon"
                id="hubChartBtn"
                data-hub-module="chart"
                data-carousel-id="chart"
                aria-pressed="false"
              >
              <img
                class="hub-icon-img"
                src="assets/img/Chart_v2.png"
                alt=""
                aria-hidden="true"
              >
              <span class="sr-only">Diagramm / Charts</span>
            </button>
              <button
                type="button"
                class="hub-icon"
                data-carousel-id="profile"
                data-hub-module="profile"
                aria-pressed="false"
              >
              <img
                class="hub-icon-img"
                src="assets/img/Personal_data_v2.png"
                alt=""
                aria-hidden="true"
              >
              <span class="sr-only">Profil &amp; Gesundheitsdaten</span>
            </button>
            </div>
          </div>
        </div>
        <div
          class="hub-quickbar"
          id="hubQuickbar"
          aria-label="Schnellaktionen"
          aria-hidden="true"
          inert
          hidden
        >
          <div class="hub-quickbar-inner" role="toolbar">
            <button
              type="button"
              class="hub-quickbar-btn"
              data-hub-module="intake"
            >
              &#x1F4A7; Intakes
            </button>
            <button
              type="button"
              class="hub-quickbar-btn"
              data-hub-module="vitals"
            >
              &#x1F493; Vitals
            </button>
            <button
              type="button"
              class="hub-quickbar-btn"
              data-hub-module="appointments"
            >
              &#x1F4C5; Neuer Termin
            </button>
            <button
              type="button"
              class="hub-quickbar-btn"
              data-hub-module="assistant-text"
            >
              &#x1F4AC; Text Chat
            </button>
            <!-- Voice parked (legacy): assistant-voice quickbar button -->
            <!--
            <button
              type="button"
              class="hub-quickbar-btn"
              data-hub-module="assistant-voice"
            >
              &#x1F399; Voice Chat
            </button>
            -->
            <button
              type="button"
              class="hub-quickbar-btn"
              data-hub-module="doctor"
            >
              &#x2695; Arzt-Ansicht
            </button>
            <button
              type="button"
              class="hub-quickbar-btn"
              data-hub-module="chart"
            >
              &#x1F4CA; Charts
            </button>
            <button
              type="button"
              class="hub-quickbar-btn"
              data-hub-module="profile"
            >
              &#x1F464; Profil
            </button>
            <button
              type="button"
              class="hub-quickbar-btn"
              data-quickbar-action="diag"
            >
              &#x1F4DD; Touch-Log
            </button>
          </div>
        </div>
      </div>
    </section>
    <!-- HUB-PANEL: Assistant Chat -->
    <section
      class="hub-panel"
      id="hubAssistantPanel"
      data-hub-panel="assistant-text"
      role="region"
      aria-labelledby="hubAssistantTitle"
      aria-hidden="true"
      hidden
    >
      <div class="hub-panel-scroll">
        <header class="hub-panel-header">
          <h2 id="hubAssistantTitle">Assistant</h2>
          <div class="assistant-panel-actions">
            <button
              type="button"
              class="btn ghost small"
              id="assistantClearChat"
              aria-label="Chat leeren"
            >
              Reset
            </button>
            <button
              type="button"
              class="hub-panel-close"
              data-panel-close
              aria-label="Fenster schliessen"
            >
              &times;
            </button>
          </div>
        </header>
        <div class="hub-panel-body">
          <section class="assistant-context" aria-live="polite">
            <div class="assistant-pills" id="assistantIntakePills">
              <div class="assistant-pill muted" data-pill="water">
                <span class="label">Wasser</span>
                <span class="value" data-pill-value>-- ml</span>
              </div>
              <div class="assistant-pill muted" data-pill="salt">
                <span class="label">Salz</span>
                <span class="value" data-pill-value>-- g</span>
              </div>
              <div class="assistant-pill muted" data-pill="protein">
                <span class="label">Protein</span>
                <span class="value" data-pill-value>-- g</span>
              </div>
            </div>
            <button
              type="button"
              class="assistant-context-toggle"
              id="assistantContextToggle"
              aria-expanded="false"
            >
              Mehr
            </button>
            <div class="assistant-context-extras" id="assistantContextExtras" hidden>
              <div class="assistant-context-item" data-extra="protein-target">
                <span class="label">Protein-Ziel</span>
                <span class="value" data-extra-value>-- g</span>
              </div>
              <div class="assistant-context-item" data-extra="ckd-stage">
                <span class="label">CKD</span>
                <span class="value" data-extra-value>--</span>
              </div>
            </div>
            <div class="assistant-appointments" id="assistantAppointments">
              <p class="muted small" data-appointments-empty>Keine Termine geladen.</p>
              <ul class="assistant-appointments-list" id="assistantAppointmentsList" hidden></ul>
            </div>
            <div class="assistant-context-expandable" id="assistantContextExpandable" hidden>
              <div class="assistant-context-item" data-expandable="remaining">
                <span class="label">Restbudget</span>
                <span class="value" data-expandable-value>--</span>
              </div>
              <div class="assistant-context-item" data-expandable="warning" hidden>
                <span class="label">Warnung</span>
                <span class="value" data-expandable-value>--</span>
              </div>
            </div>
          </section>

          <div class="assistant-chat" id="assistantChat" aria-live="polite">
            <div class="assistant-chat-empty">
              <p class="muted">Starte eine Unterhaltung oder schicke ein Foto deines Essens.</p>
            </div>
            <template id="assistantMessageTemplate">
              <div class="assistant-bubble" data-role="assistant">
                <div class="assistant-text-line"></div>
              </div>
            </template>
            <template id="assistantPhotoTemplate">
              <div class="assistant-bubble assistant-photo-bubble" data-role="system">
                <figure class="assistant-photo">
                  <img src="" alt="Hochgeladenes Foto" loading="lazy">
                  <figcaption class="assistant-photo-status" aria-live="polite">Analyse l√§uft ‚Ä¶</figcaption>
                </figure>
                <div class="assistant-text-line assistant-photo-result muted">Noch kein Ergebnis.</div>
              </div>
            </template>
          </div>
          <form class="assistant-input-bar" id="assistantChatForm" autocomplete="off">
            <div class="assistant-input-tools">
              <button
                type="button"
                class="assistant-tool-btn"
                id="assistantCameraBtn"
                aria-label="Foto aufnehmen oder ausw√§hlen"
              >
                üì∑
              </button>

            </div>
            <input
              type="text"
              id="assistantMessage"
              class="assistant-input"
              placeholder="Frage MIDAS etwas ‚Ä¶"
            >
            <button class="btn primary" type="submit" id="assistantSendBtn">Senden</button>
          </form>
        </div>
      </div>
    </section>
    <!-- HUB-PANEL: Profil -->
    <section
      class="hub-panel"
      id="hubProfilePanel"
      data-hub-panel="profile"
      role="region"
      aria-labelledby="hubProfileTitle"
      aria-hidden="true"
      hidden
    >
      <div class="hub-panel-scroll">
        <header class="hub-panel-header">
          <h2 id="hubProfileTitle">Profil</h2>
          <button
            type="button"
            class="hub-panel-close"
            data-panel-close
            aria-label="Fenster schliessen"
          >
            &times;
          </button>
        </header>
        <div class="hub-panel-body">
          <form class="profile-form" id="profileForm" autocomplete="off">
            <div class="form-grid">
              <label class="field-group" for="profileFullName">
                <span class="label">Name</span>
                <input
                  type="text"
                  id="profileFullName"
                  placeholder="z.‚ÄØB. Stephan Schabuss"
                >
              </label>
              <label class="field-group" for="profileBirthDate">
                <span class="label">Geburtsdatum</span>
                <input type="date" id="profileBirthDate">
              </label>
              <label class="field-group" for="profileHeight">
                <span class="label">Gr√∂√üe (cm)</span>
                <input
                  type="number"
                  id="profileHeight"
                  inputmode="numeric"
                  min="120"
                  max="230"
                  placeholder="183"
                >
              <span class="field-hint muted small">
                Wird f√ºr BMI/Charts verwendet.
              </span>
            </label>
            <label class="field-group" for="profileCkdBadge">
              <span class="label">CKD-Stufe (Lab)</span>
              <input
                type="text"
                id="profileCkdBadge"
                placeholder="Noch keine Labordaten"
                disabled
              >
              <span class="field-hint muted small">
                Wird automatisch aus den letzten Labordaten ermittelt.
              </span>
            </label>
            <label class="field-group" for="profileMedications">
              <span class="label">Medikation</span>
              <textarea
                id="profileMedications"
                rows="3"
                placeholder="Wird automatisch geladen"
                readonly
              ></textarea>
              <span class="field-hint muted small">
                Anzeige der aktiven Medikamente (Tablettenmanager). √Ñnderungen im TAB-Panel vornehmen.
              </span>
            </label>
              <label class="field-group" for="profileDoctorName">
                <span class="label">Hausarzt</span>
                <input
                  type="text"
                  id="profileDoctorName"
                  placeholder="z.‚ÄØB. Dr. Maier"
                >
              </label>
              <label class="field-group" for="profileDoctorEmail">
                <span class="label">Hausarzt E-Mail</span>
                <input
                  type="email"
                  id="profileDoctorEmail"
                  placeholder="arzt@example.com"
                >
                <span class="field-hint muted small">
                  Wird f√ºr Mail-Shortcuts (Low-Stock Hinweis) verwendet.
                </span>
              </label>
              <label class="field-group" for="profileSaltLimit">
                <span class="label">Salzlimit (g/Tag)</span>
                <input
                  type="number"
                  id="profileSaltLimit"
                  step="0.1"
                  min="0"
                  placeholder="5"
                >
              </label>
              <label class="field-group checkbox" for="profileProteinDoctorLock">
                <input type="checkbox" id="profileProteinDoctorLock">
                <span class="label">Doctor-Lock (Protein fix)</span>
              </label>
              <label class="field-group" for="profileProteinDoctorMin">
                <span class="label">Doctor Min (g/Tag)</span>
                <input
                  type="number"
                  id="profileProteinDoctorMin"
                  step="1"
                  min="0"
                  placeholder="90"
                >
              </label>
              <label class="field-group" for="profileProteinDoctorMax">
                <span class="label">Doctor Max (g/Tag)</span>
                <input
                  type="number"
                  id="profileProteinDoctorMax"
                  step="1"
                  min="0"
                  placeholder="110"
                >
              </label>
              <label class="field-group" for="profileProteinMin">
                <span class="label">Protein Min (Auto, g/Tag)</span>
                <input
                  type="number"
                  id="profileProteinMin"
                  step="1"
                  min="0"
                  placeholder="95"
                  disabled
                >
              </label>
              <label class="field-group" for="profileProteinMax">
                <span class="label">Protein Max (Auto, g/Tag)</span>
                <input
                  type="number"
                  id="profileProteinMax"
                  step="1"
                  min="0"
                  placeholder="110"
                  disabled
                >
                <span class="field-hint muted small">
                  Wird automatisch berechnet.
                </span>
              </label>
              <label class="field-group" for="profileIsSmoker">
                <span class="label">Raucherstatus</span>
                <select id="profileIsSmoker">
                  <option value="no" selected>Nichtraucher</option>
                  <option value="yes">Raucher</option>
                </select>
              </label>
              <label class="field-group" for="profileLifestyleNote">
                <span class="label">Lifestyle-Notiz</span>
                <textarea
                  id="profileLifestyleNote"
                  rows="3"
                  placeholder="z.‚ÄØB. 1‚Äì3√ó Krafttraining/Woche."
                ></textarea>
              </label>
            </div>
            <div class="profile-actions">
              <button type="button" class="btn primary" id="profileSaveBtn">
                Profil speichern
              </button>
              <button type="button" class="btn ghost" id="profileRefreshBtn">
                Aktualisieren
              </button>
            </div>
          </form>
          <section class="profile-overview card" aria-live="polite">
            <header>
              <h3>Aktuelle Daten</h3>
            </header>
            <div id="profileOverview" class="profile-overview-list">
              <p class="muted small">Noch keine Daten gespeichert.</p>
            </div>
          </section>
        </div>
      </div>
    </section>
    <!-- Milchglas-/Lock-Overlay fuer aktive Panels -->
    <div class="hub-backdrop" data-hub-backdrop aria-hidden="true"></div>
    <!-- HUB-PANEL: Appointments -->
    <section
      class="hub-panel"
      id="hubAppointmentsPanel"
      data-hub-panel="appointments"
      role="region"
      aria-labelledby="hubAppointmentsTitle"
      aria-hidden="true"
      hidden
    >
      <div class="hub-panel-scroll">
        <header class="hub-panel-header">
          <h2 id="hubAppointmentsTitle">Termine</h2>
          <button
            type="button"
            class="hub-panel-close"
            data-panel-close
            aria-label="Fenster schliessen"
          >
            &times;
          </button>
        </header>
        <div class="hub-panel-body">
          <form class="appointments-form" id="appointmentsForm" autocomplete="off">
            <div class="appointments-grid">
              <label>
                <span>Terminname</span>
                <input type="text" id="apptTitle" placeholder="z. B. Kontrollbesuch" required>
              </label>
              <label class="appointments-date">
                <span>Datum</span>
                <input type="date" id="apptDate" required>
              </label>
              <label class="appointments-repeat">
                <span>Wiederholen</span>
                <select id="apptRepeatRule">
                  <option value="none">Nie</option>
                  <option value="monthly">Monatlich</option>
                  <option value="annual">J√§hrlich</option>
                </select>
              </label>
              <label>
                <span>Uhrzeit</span>
                <input type="time" id="apptTime">
              </label>
              <label>
                <span>Ort / Adresse</span>
                <input type="text" id="apptLocation" placeholder="z. B. Ordination Dr. XY">
              </label>
            </div>
            <label class="appointments-notes">
              <span>Notizen / Vorbereitung</span>
              <textarea id="apptNotes" rows="2" placeholder="Mitbringen: Befunde, Liste der Medikamente ..."></textarea>
            </label>
            <div class="appointments-actions">
              <button class="btn primary" type="submit">
                &#x1F4BE; Termin speichern
              </button>
              <button class="btn ghost" type="button" id="appointmentsOverviewBtn">
                √úbersicht anzeigen
              </button>
            </div>
          </form>
          <section class="appointments-overview" id="appointmentsOverview" aria-live="polite">
            <header class="appointments-overview-header">
              <h3>Kommende Termine</h3>
              <p class="muted small" id="appointmentsOverviewSubtitle">Noch keine Eintr√§ge.</p>
            </header>
            <div class="appointments-columns" id="appointmentsColumns">
              <!-- dynamische Karten -->
            </div>
          </section>
        </div>
      </div>
    </section>
    <!-- HUB-PANEL: Intake -->
    <section
      class="hub-panel"
      id="hubIntakePanel"
      data-hub-panel="intake"
      role="region"
      aria-labelledby="hubIntakeTitle"
      aria-hidden="true"
      hidden
    >
      <div class="hub-panel-scroll">
        <header class="hub-panel-header">
          <h2 id="hubIntakeTitle">Fl√ºssigkeit & Intake</h2>
          <button
            type="button"
            class="hub-panel-close"
            data-panel-close
            data-close-mode="instant"
            aria-label="Fenster schliessen"
          >
            &times;
          </button>
        </header>
        <div class="hub-panel-body" id="hubOverlayContent">
          <div class="hub-intake-tabs" role="tablist" aria-label="Intake Bereiche">
            <button class="btn ghost is-active" id="intakeTabInBtn" type="button" data-intake-tab="in" aria-controls="hubIntakePanelIn" aria-selected="true">IN</button>
            <button class="btn ghost" id="intakeTabTabBtn" type="button" data-intake-tab="tab" aria-controls="hubIntakePanelTab" aria-selected="false">TAB</button>
          </div>
          <div class="hub-intake-tab-panels">
            <div class="hub-intake-panel is-active" id="hubIntakePanelIn" data-intake-panel="in" role="tabpanel" aria-labelledby="intakeTabInBtn">
              <div class="hub-intake-form" id="cap-intake-wrap">
              <div class="hub-intake-grid intake-card-grid">
              <label class="intake-card capture-card">
                <span class="capture-card-label">Wasser (ml)</span>
                <input
                  type="number"
                  id="cap-water-add"
                  min="0"
                  step="50"
                  placeholder="z. B. 250"
                >
                <div class="capture-card-actions">
                  <button class="btn primary" id="cap-water-add-btn" type="button">+ Menge</button>
                  <div class="intake-pill-slot" data-pill-kind="water" aria-live="polite"></div>
                </div>
              </label>
              <label class="intake-card capture-card">
                <span class="capture-card-label">Salz &amp; Protein</span>
                <div class="capture-card-fields">
                  <input
                    type="text"
                    id="cap-salt-add"
                    inputmode="decimal"
                    autocomplete="off"
                    placeholder="Salz (z. B. 0,5)"
                  >
                  <input
                    type="text"
                    id="cap-protein-add"
                    inputmode="decimal"
                  autocomplete="off"
                  placeholder="Protein (z. B. 20,0)"
                >
                </div>
                <div class="capture-card-actions">
                  <button class="btn primary" id="cap-salt-protein-btn" type="button">+ Menge</button>
                  <div class="intake-pill-slot" data-pill-kind="salt" aria-live="polite"></div>
                  <div class="intake-pill-slot" data-pill-kind="protein" aria-live="polite"></div>
                </div>
              </label>
              <div id="medDailyList" class="medication-card-grid" aria-live="polite"></div>
              <div id="medLowStockBox" class="medication-low-stock" hidden></div>
            </div>
            <div class="hub-intake-pills" id="capturePillsRow" data-role="hub-intake-pills">
              <div id="cap-intake-status-top" class="small u-flex-wrap-gap8-opacity80"></div>
            </div>
            
              </div>
            </div>
            <div class="hub-intake-panel" id="hubIntakePanelTab" data-intake-panel="tab" role="tabpanel" aria-labelledby="intakeTabTabBtn" aria-hidden="true" hidden>
              <div class="medication-manager" id="medicationManager">
                <form id="medicationForm" class="medication-form card-nested" autocomplete="off">
                  <input type="hidden" id="medFormId">
                  <div class="medication-form-grid">
                    <label class="field-group" for="medFormName">
                      <span class="label">Name *</span>
                      <input type="text" id="medFormName" placeholder="z. B. Valsartan" required>
                    </label>
                    <label class="field-group" for="medFormIngredient">
                      <span class="label">Wirkstoff</span>
                      <input type="text" id="medFormIngredient" placeholder="z. B. Valsartan">
                    </label>
                    <label class="field-group" for="medFormStrength">
                      <span class="label">St√§rke</span>
                      <input type="text" id="medFormStrength" placeholder="z. B. 160 mg">
                    </label>
                    <label class="field-group" for="medFormDose">
                      <span class="label">Dosen / Tag</span>
                      <input type="number" id="medFormDose" min="1" max="96" step="1" value="1">
                    </label>
                    <label class="field-group" for="medFormStock">
                      <span class="label">Bestand (Stk.)</span>
                      <input type="number" id="medFormStock" min="-999" step="1" value="0">
                    </label>
                    <label class="field-group" for="medFormLowStock">
                      <span class="label">Low-Stock (Tage)</span>
                      <input type="number" id="medFormLowStock" min="0" step="1" value="7">
                    </label>
                    <label class="field-group checkbox" for="medFormActive">
                      <input type="checkbox" id="medFormActive" checked>
                      <span class="label">Aktiv</span>
                    </label>
                  </div>
                  <div class="medication-form-actions">
                    <button class="btn primary" type="submit" id="medFormSaveBtn">Speichern</button>
                    <button class="btn ghost" type="button" id="medFormResetBtn">Reset</button>
                    <span class="medication-form-status small muted" id="medFormStatus" aria-live="polite"></span>
                  </div>
                </form>
                <section class="medication-cards card-nested" id="medicationCards" aria-live="polite">
                  <header class="medication-cards-header">
                    <h3>Medikamente</h3>
                    <p class="muted small" id="medicationCardsMeta">Noch keine Daten geladen.</p>
                  </header>
                  <div class="medication-card-list" id="medicationCardList">
                    <p class="muted small" data-medication-empty>Keine Medikamente vorhanden. Bitte lege oben ein neues an.</p>
                  </div>
                </section>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- HUB-PANEL: Doctor -->
    <section
      class="hub-panel"
      id="hubDoctorPanel"
      data-hub-panel="doctor"
      data-close-mode="instant"
      role="region"
      aria-labelledby="hubDoctorTitle"
      aria-hidden="true"
      hidden
    >
      <div class="hub-panel-scroll">
        <header class="hub-panel-header">
          <h2 id="hubDoctorTitle">Arzt-Ansicht</h2>
          <button
            type="button"
            class="hub-panel-close"
            data-panel-close
            data-close-mode="instant"
            aria-label="Fenster schliessen"
          >
            &times;
          </button>
        </header>
        <div class="hub-panel-body" id="hubDoctorContent">
          <section class="card doctor-panel" id="doctor" aria-labelledby="doctorHeading">
            <h2 class="sr-only" id="doctorHeading">Arzt-Ansicht</h2>
            <div class="toolbar">
              <strong id="doctorTitle">Arzt-Ansicht</strong>
              <div class="center-group">
                <label class="small">
                  Von
                  <input class="u-w-auto" type="date" id="from">
                </label>
                <label class="small">
                  Bis
                  <input class="u-w-auto" type="date" id="to">
                </label>
                <button class="btn ghost" id="applyRange" type="button">Anwenden</button>
                <button class="btn ghost" id="doctorChartBtn" type="button" title="Werte als Grafik">
                  Werte anzeigen
                </button>
                <button class="btn ghost" id="doctorExportJson" type="button">Export JSON</button>
                <button class="btn ghost" id="doctorTabInboxBtn" data-doctor-tab="inbox" type="button" role="tab" aria-selected="false" aria-controls="doctorTabInbox">Inbox</button>
                <button class="btn ghost" id="doctorMonthlyReportBtn" type="button" disabled>
                  Monatsbericht
                </button>
              </div>
            </div>
            <div class="doctor-trendpilot" id="doctorTrendpilot" aria-live="polite"></div>
            <div id="doctorDailyWrap">
              <nav class="doctor-tabs" role="tablist" aria-label="Domains">
                <button class="btn ghost is-active" id="doctorTabBpBtn" data-doctor-tab="bp" role="tab" aria-selected="true" aria-controls="doctorTabBp" type="button">BP</button>
                <button class="btn ghost" id="doctorTabBodyBtn" data-doctor-tab="body" role="tab" aria-selected="false" aria-controls="doctorTabBody" type="button">Body</button>
                <button class="btn ghost" id="doctorTabLabBtn" data-doctor-tab="lab" role="tab" aria-selected="false" aria-controls="doctorTabLab" type="button">Lab</button>
                <button class="btn ghost" id="doctorTabActivityBtn" data-doctor-tab="activity" role="tab" aria-selected="false" aria-controls="doctorTabActivity" type="button">Training</button>
              </nav>
              <div class="doctor-view" id="doctorView">
                <div class="doctor-tab-panel is-active" id="doctorTabBp" data-doctor-panel="bp" role="tabpanel" aria-labelledby="doctorTabBpBtn"></div>
                <div class="doctor-tab-panel" id="doctorTabBody" data-doctor-panel="body" role="tabpanel" aria-labelledby="doctorTabBodyBtn" hidden></div>
                <div class="doctor-tab-panel" id="doctorTabLab" data-doctor-panel="lab" role="tabpanel" aria-labelledby="doctorTabLabBtn" hidden></div>
                <div class="doctor-tab-panel" id="doctorTabActivity" data-doctor-panel="activity" role="tabpanel" aria-labelledby="doctorTabActivityBtn" hidden></div>
                <div class="doctor-tab-panel" id="doctorTabInbox" data-doctor-panel="inbox" role="tabpanel" aria-labelledby="doctorTabInboxBtn" hidden></div>
              </div>
            </div>
            <div class="small u-mt-6">
              Tipp: "Werte anzeigen" √∂ffnet die passende Grafik zum aktuellen Tab (Daily).
            </div>
          </section>
        </div>
      </div>
    </section>
    <!-- HUB-PANEL: Vitals -->
    <section
      class="hub-panel"
      id="hubVitalsPanel"
      data-hub-panel="vitals"
      role="region"
      aria-labelledby="hubVitalsTitle"
      aria-hidden="true"
      hidden
    >
      <div class="hub-panel-scroll">
        <header class="hub-panel-header">
          <h2 id="hubVitalsTitle">Vitaldaten</h2>
          <button
            type="button"
            class="hub-panel-close"
            data-panel-close
            aria-label="Fenster schliessen"
          >
            &times;
          </button>
        </header>
        <div class="hub-panel-body">
            <div class="hub-vitals">
              <div class="card-nested hub-vitals-controls">
                <div class="control-group">
                  <label for="date">Datum</label>
                  <input
                    type="date"
                    id="date"
                    class="hub-date-control"
                    aria-label="Datum waehlen"
                  >
                </div>
                <div class="hub-vitals-actions hub-vitals-actions-inline" role="group" aria-label="Aktionen f√ºr Arztbereich">
                  <button class="btn ghost" id="vitalsDoctorBtn" type="button">
                    Arzt-Ansicht
                  </button>
                  <button class="btn ghost" id="vitalsChartBtn" type="button">
                    Diagramm
                  </button>
                </div>
              </div>
              <div class="hub-vitals-tabs" role="tablist" aria-label="Vitals Bereiche">
                <button class="btn ghost is-active" type="button" data-vitals-tab="bp" aria-selected="true">BP</button>
                <button class="btn ghost" type="button" data-vitals-tab="body" aria-selected="false">Body</button>
                <button class="btn ghost" type="button" data-vitals-tab="lab" aria-selected="false">Lab</button>
                <button class="btn ghost" type="button" data-vitals-tab="activity" aria-selected="false">Training</button>
              </div>
              <div class="hub-vitals-panel is-active" data-vitals-panel="bp">
                <div class="hub-vitals-bp">
              <div class="card-nested bp-combined-card">
              <div class="bp-context-card">
                <div class="bp-context-header">
                  <label for="bpContextSel">Messzeitpunkt</label>
                  <select id="bpContextSel">
                    <option value="M">Morgens</option>
                    <option value="A">Abends</option>
                  </select>
                </div>
              </div>
              <div class="bp-pane active" data-context="M">
                <div class="grid">
                  <div>
                    <label>Systolisch (mmHg)</label>
                    <input
                      type="number"
                      id="captureAmount"
                      inputmode="numeric"
                      placeholder="z. B. 128"
                    >
                  </div>
                  <div>
                    <label>Diastolisch (mmHg)</label>
                    <input
                      type="number"
                      id="diaM"
                      inputmode="numeric"
                      placeholder="z. B. 82"
                    >
                  </div>
                  <div>
                    <label>Puls (bpm)</label>
                    <input
                      type="number"
                      id="pulseM"
                      inputmode="numeric"
                      placeholder="z. B. 66"
                    >
                  </div>
                </div>
                <div class="row u-mt-6">
                  <textarea
                    id="bpCommentM"
                    class="small"
                    placeholder="Kommentar Morgens (optional)"
                  ></textarea>
                </div>
                <div class="panel-actions">
                  <button class="btn primary save-bp-panel-btn" data-context="M" type="button">
                    &#x1F4BE; Blutdruck speichern
                  </button>
                </div>
              </div>
              <div class="bp-pane" data-context="A">
                <div class="grid">
                  <div>
                    <label>Systolisch (mmHg)</label>
                    <input
                      type="number"
                      id="sysA"
                      inputmode="numeric"
                      placeholder="z. B. 128"
                    >
                  </div>
                  <div>
                    <label>Diastolisch (mmHg)</label>
                    <input
                      type="number"
                      id="diaA"
                      inputmode="numeric"
                      placeholder="z. B. 82"
                    >
                  </div>
                  <div>
                    <label>Puls (bpm)</label>
                    <input
                      type="number"
                      id="pulseA"
                      inputmode="numeric"
                      placeholder="z. B. 66"
                    >
                  </div>
                </div>
                <div class="row u-mt-6">
                  <textarea
                    id="bpCommentA"
                    class="small"
                    placeholder="Kommentar Abends (optional)"
                  ></textarea>
                </div>
                <div class="panel-actions">
                  <button class="btn primary save-bp-panel-btn" data-context="A" type="button">
                    &#x1F4BE; Blutdruck speichern
                  </button>
                </div>
              </div>
              </div>
              </div>
              </div>
              <div class="hub-vitals-panel" data-vitals-panel="body" aria-hidden="true" hidden>
            <div class="hub-vitals-body card-nested">
              <div class="body-grid">
                <div>
                  <label>Gewicht (kg)</label>
                  <input
                    type="number"
                    step="0.1"
                    id="weightDay"
                    inputmode="decimal"
                    placeholder="z. B. 84.2"
                  >
                </div>
                <div>
                  <label>Bauchumfang (cm)</label>
                  <input
                    id="input-waist-cm"
                    type="text"
                    inputmode="decimal"
                    autocomplete="off"
                    placeholder="z. B. 104,5"
                  >
                </div>
                <div>
                  <label>Fett (%)</label>
                  <input
                    id="fatPctDay"
                    type="text"
                    inputmode="decimal"
                    autocomplete="off"
                    placeholder="z. B. 22,5"
                  >
                </div>
                <div>
                  <label>Muskel (%)</label>
                  <input
                    id="musclePctDay"
                    type="text"
                    inputmode="decimal"
                    autocomplete="off"
                    placeholder="z. B. 38,0"
                  >
                </div>
              </div>
                <div class="panel-actions">
                  <button class="btn primary" id="saveBodyPanelBtn" type="button">
                    &#x1F4BE; K√∂rper speichern
                  </button>
                </div>
              </div>
              </div>
              <div class="hub-vitals-panel" data-vitals-panel="lab" aria-hidden="true" hidden>
            <div class="hub-vitals-lab card-nested">
              <div class="lab-grid">
                <div>
                  <label>eGFR (ml/min/1,73 m¬≤)</label>
                  <input
                    id="labEgfr"
                    type="text"
                    inputmode="decimal"
                    autocomplete="off"
                    placeholder="z. B. 68"
                  >
                </div>
                <div>
                  <label>Kreatinin (mg/dl)</label>
                  <input
                    id="labCreatinine"
                    type="text"
                    inputmode="decimal"
                    autocomplete="off"
                    placeholder="z. B. 1,2"
                  >
                </div>
                <div>
                  <label>CKD-Stufe</label>
                  <select id="labCkdStage">
                    <option value="">Ausw√§hlen</option>
                    <option value="G1">G1</option>
                    <option value="G2">G2</option>
                    <option value="G3a">G3a</option>
                    <option value="G3b">G3b</option>
                    <option value="G4">G4</option>
                    <option value="G5">G5</option>
                    <option value="G1 A1">G1 A1</option>
                    <option value="G1 A2">G1 A2</option>
                    <option value="G1 A3">G1 A3</option>
                    <option value="G2 A1">G2 A1</option>
                    <option value="G2 A2">G2 A2</option>
                    <option value="G2 A3">G2 A3</option>
                    <option value="G3a A1">G3a A1</option>
                    <option value="G3a A2">G3a A2</option>
                    <option value="G3a A3">G3a A3</option>
                    <option value="G3b A1">G3b A1</option>
                    <option value="G3b A2">G3b A2</option>
                    <option value="G3b A3">G3b A3</option>
                    <option value="G4 A1">G4 A1</option>
                    <option value="G4 A2">G4 A2</option>
                    <option value="G4 A3">G4 A3</option>
                    <option value="G5 A1">G5 A1</option>
                    <option value="G5 A2">G5 A2</option>
                    <option value="G5 A3">G5 A3</option>
                  </select>
                  <span class="field-hint muted small">Direkt aus dem Arztbrief √ºbernehmen.</span>
                </div>
                <div>
                  <label>HbA1c (%)</label>
                  <input
                    id="labHba1c"
                    type="text"
                    inputmode="decimal"
                    autocomplete="off"
                    placeholder="z. B. 6,5"
                  >
                </div>
                <div>
                  <label>LDL (mg/dl)</label>
                  <input
                    id="labLdl"
                    type="text"
                    inputmode="decimal"
                    autocomplete="off"
                    placeholder="z. B. 120"
                  >
                </div>
                <div>
                  <label>Kalium (mmol/l)</label>
                  <input
                    id="labPotassium"
                    type="text"
                    inputmode="decimal"
                    autocomplete="off"
                    placeholder="z. B. 4,2"
                  >
                </div>
                <div class="lab-comment">
                  <label>Kommentar</label>
                  <textarea
                    id="labComment"
                    placeholder="Kurznotiz (optional)"
                  ></textarea>
                </div>
              </div>
              <div class="panel-actions">
                <button class="btn primary" id="saveLabPanelBtn" type="button">
                  &#x1F489; Labor speichern
                </button>
              </div>
            </div>
          </div>
              <div class="hub-vitals-panel" data-vitals-panel="activity" aria-hidden="true" hidden>
            <div class="hub-vitals-activity card-nested">
              <form id="activityForm" class="activity-form" autocomplete="off">
                <div class="activity-form-grid">
                  <label class="field-group" for="activityName">
                    <span class="label">Aktivit√§t</span>
                    <input
                      type="text"
                      id="activityName"
                      placeholder="z. B. Gym"
                      required
                    >
                  </label>
                  <label class="field-group" for="activityDuration">
                    <span class="label">Dauer (Minuten)</span>
                    <input
                      type="number"
                      id="activityDuration"
                      min="1"
                      inputmode="numeric"
                      placeholder="z. B. 45"
                      required
                    >
                  </label>
                </div>
                <label class="field-group" for="activityNote">
                  <span class="label">Notiz (optional)</span>
                  <textarea
                    id="activityNote"
                    rows="2"
                    placeholder="Kurznotiz"
                  ></textarea>
                </label>
                <div class="activity-form-actions">
                  <button class="btn primary" id="activitySaveBtn" type="submit">Speichern</button>
                  <button class="btn ghost" id="activityCancelBtn" type="button">Zur√ºcksetzen</button>
                  <span class="small muted" id="activityFormStatus" aria-live="polite"></span>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
          </div>
        </div>
      </div>
    </section>
    <!-- END MODULE: HUB -->
    <!-- MODULE: CAPTURE (Intake)
      intent: Tageserfassung (UI) inkl. Intake/BP/Body/Termine, verbindet Benutzeraktionen mit Save-Flows
      contracts: nutzt DATA ACCESS.saveIntakeTotals*, AUTH.isLoggedIn, UI.requestUiRefresh
      todo: @extract-candidate bindIntakeCapture, refreshCaptureIntake spaeter extrahieren
    -->
    <!-- Capture -->
    <section class="view active" id="capture" aria-labelledby="captureHeading">
      <h2 class="sr-only" id="captureHeading">Tageserfassung</h2>
    </section>
    <!-- END MODULE -->
    <!-- Lifestyle (Heute) -->
    <!-- MODULE: DOCTOR VIEW
      intent: Aggregations-UI fuer Aerzt:innen, steuert Zeitraum-Filter, Export und Chart-Pivot
      contracts: nutzt DATA ACCESS.fetchDailyOverview, CHARTS.renderDailyChart, AUTH.setDoctorAccess @public
      todo: @extract-candidate buildDoctorSummaryJson @public spaeter bereitstellen
    -->
    <!-- Doctor -->
    <!-- END MODULE -->
  </main>
  <!-- Supabase (UMD, v2) -->
  <script
    src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"
    crossorigin="anonymous"
  ></script>
  <script src="app/core/boot-flow.js"></script>
  <script src="app/core/config.js"></script>
  <script src="app/core/diag.js"></script>
  <script src="app/core/pwa.js"></script>
  <script src="app/diagnostics/logger.js"></script>
  <script src="app/diagnostics/perf.js"></script>
  <script src="app/diagnostics/monitor.js"></script>
  <!-- Voice parked (legacy): VAD + voice module disabled -->
  <!-- <script src="app/modules/assistant-stack/vad/vad.js"></script> -->
  <!-- <script src="app/modules/assistant-stack/voice/index.js"></script> -->
  <script src="app/modules/hub/hub-aura3d.js"></script>
  <script src="app/modules/appointments/index.js"></script>
  <script src="app/modules/profile/index.js"></script>
  <script src="app/modules/intake-stack/medication/index.js"></script>
  <script type="module" src="app/modules/assistant-stack/assistant/suggest-store.js"></script>
  <script type="module" src="app/modules/assistant-stack/assistant/suggest-ui.js"></script>
  <script type="module" src="app/modules/assistant-stack/assistant/allowed-actions.js"></script>
  <script type="module" src="app/modules/assistant-stack/assistant/day-plan.js"></script>
  <script type="module" src="app/modules/assistant-stack/assistant/index.js"></script>
  <script src="app/modules/hub/index.js"></script>
  <!-- @refactor: moved to assets/js/ui.js -->
  <script src="assets/js/ui.js"></script>
  <!-- @refactor: moved to assets/js/ui-layout.js -->
  <script src="assets/js/ui-layout.js"></script>
  <!-- @refactor: moved to assets/js/ui-errors.js -->
  <script src="assets/js/ui-errors.js"></script>
  <!-- @refactor: Phase 2 - app/core/utils.js -->
  <script src="app/core/utils.js"></script>
  <!-- @refactor: moved to assets/js/format.js -->
  <script src="assets/js/format.js"></script>
  <!-- @refactor: Phase 2 app/core/capture-globals.js -->
  <script src="app/core/capture-globals.js"></script>
  <!-- @refactor: moved to assets/js/data-local.js -->
  <script src="assets/js/data-local.js"></script>
  <!-- @refactor: Phase 3 - app/modules/vitals-stack/vitals/index.js -->
  <script src="app/modules/vitals-stack/vitals/index.js"></script>
  <!-- @refactor: Phase 9 - app/modules/vitals-stack/activity/index.js -->
  <script src="app/modules/vitals-stack/activity/index.js"></script>
  <!-- @refactor: Phase 2 - app/modules/intake-stack/intake/index.js -->
  <script src="app/modules/intake-stack/intake/index.js"></script>
  <!-- Shared capture helpers -->
  <script src="app/modules/vitals-stack/vitals/entry.js"></script>
    <!-- @refactor: Phase 3 - app/modules/vitals-stack/vitals/bp.js -->
    <script src="app/modules/vitals-stack/vitals/bp.js"></script>
    <!-- @refactor: Phase 3 - app/modules/vitals-stack/vitals/body.js -->
    <script src="app/modules/vitals-stack/vitals/body.js"></script>
    <!-- @refactor: Phase 8 - app/modules/vitals-stack/protein/index.js -->
    <script src="app/modules/vitals-stack/protein/index.js"></script>
    <!-- @refactor: Phase 4 - app/modules/vitals-stack/vitals/lab.js -->
    <script src="app/modules/vitals-stack/vitals/lab.js"></script>
  <!-- @refactor: moved to app/modules/vitals-stack/trendpilot/data.js -->
  <script src="app/modules/vitals-stack/trendpilot/data.js"></script>
  <!-- @refactor: Phase 2 - app/supabase/index.js -->
  <!-- @refactor: Phase 2 - legacy proxy thin shim -->
  <script type="module" src="app/supabase/index.js"></script>
  <script type="module" src="assets/js/boot-auth.js"></script>
  <!-- @refactor: moved to assets/js/ui-tabs.js -->
  <script src="assets/js/ui-tabs.js"></script>
  <!-- @refactor: moved to app/modules/vitals-stack/trendpilot/index.js -->
  <script src="app/modules/vitals-stack/trendpilot/index.js"></script>
  <!-- @refactor: Phase 10 - app/modules/doctor-stack/doctor/index.js -->
  <script src="app/modules/doctor-stack/doctor/index.js"></script>
  <!-- @refactor: Phase 9 - app/modules/doctor-stack/charts/index.js -->
  <script src="app/modules/doctor-stack/charts/index.js"></script>
  <script src="assets/js/main.js"></script>
  <!-- Login-Overlay (zentriert) -->
  <div id="loginOverlay" class="u-hidden">
    <div class="login-card" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <h3 id="loginTitle">Willkommen</h3>
      <p class="small u-mb-8">Melde dich an, um Arzt-Ansicht & Diagramme zu nutzen.</p>
      <button class="btn primary u-w100-h48-mb12" id="googleLoginBtn" type="button">
        Mit Google anmelden
      </button>
      <details id="configAdv" class="config-box u-mb-12">
        <summary class="small u-config-summary">Erweiterte Einstellungen</summary>
        <div class="u-flex-col-gap6-mt4">
          <label class="small" for="configRestUrl">Supabase REST-Endpoint</label>
          <input
            id="configRestUrl"
            class="u-input-field"
            type="url"
            inputmode="url"
            placeholder="https://...supabase.co/rest/v1/health_events"
          >
          <label class="small u-mt-4" for="configAnonKey">Supabase ANON-Key</label>
          <textarea
            id="configAnonKey"
            class="u-textarea-field"
            rows="3"
            placeholder="ANON-Key (kein service_role)"
          ></textarea>
          <button class="btn ghost u-w100-mt4" id="configSaveBtn" type="button">
            Konfiguration speichern
          </button>
          <div id="configStatus" class="small u-status-muted"></div>
        </div>
      </details>
      <div id="whoAmI" class="small u-text-center-mt6"></div>
    </div>
  </div>
  <!-- App-Lock Overlay (zentriert) -->
  <div id="appLock" class="u-hidden">
    <div class="lock-card" role="dialog" aria-modal="true" aria-labelledby="lockTitle">
      <h3 id="lockTitle">App gesperrt</h3>
      <p class="small u-mb-8">
        Bitte entsperren: bevorzugt per Passkey (Finger/Face). Alternativ PIN.
      </p>
      <div class="row u-gap-8">
        <button class="btn primary u-w100-h48" id="unlockPasskeyBtn" type="button">
          Per Passkey entsperren
        </button>
      </div>
      <div class="pin-wrap">
        <input
          id="pinInput"
          type="password"
          inputmode="numeric"
          autocomplete="off"
          placeholder="PIN (optional)"
        >
        <button class="btn ghost" id="unlockPinBtn" type="button">PIN</button>
      </div>
      <div class="small u-mt8-opacity80">
        <button class="btn ghost u-w100-mt6" id="setupPasskeyBtn" type="button">
          Passkey einrichten
        </button>
        <button class="btn ghost u-w100-mt6" id="setPinBtn" type="button">
          PIN setzen/√§ndern
        </button>
      </div>
      <button class="btn ghost u-w100-mt8" id="lockCancelBtn" type="button">
        Abbrechen
      </button>
      <div id="lockMsg" class="small u-mt6-muted"></div>
    </div>
  </div>
</body>
</html>
<!-- ANNOTATION SUMMARY
  modules:
    - BOOTSTRAP & CONSTANTS -> #SUBMODULES: 0, #@extract: 0, Exports:[none]
    - CAPTURE (Intake) - HTML Shell -> #SUBMODULES: 0, #@extract: 0, Exports:[none]
    - DOCTOR VIEW - HTML -> #SUBMODULES: 0, #@extract: 0, Exports:[none]
    - CONFIG -> #SUBMODULES: 0, #@extract: 0, Exports:[DEV_ALLOW_DEFAULTS, APPOINTMENT_ROLES]
    - LOGGING & DIAGNOSTICS -> #SUBMODULES: 2, #@extract: 0, Exports:[diag, recordPerfStat, uiError, uiInfo]
    - UI / ROUTING / VIEWS - Core (Refresh/Help) -> #SUBMODULES: 7, #@extract: 0, Exports:[requestUiRefresh, runUiRefresh, maybeRefreshForTodayChange, setUnderlayInert]
    - AUTH - Guards -> #SUBMODULES: 3, #@extract: 0, Exports:[isLoggedIn, isLoggedInFast, setAuthGuard, setDoctorAccess]
    - UTILITIES -> #SUBMODULES: 0, #@extract: 0, Exports:[$,$$,fmtNum,todayStr,timeStr,esc,nl2br]
    - CAPTURE (Intake) - State & Timer -> #SUBMODULES: 0, #@extract: 5, Exports:[refreshCaptureIntake, scheduleMidnightRefresh, maybeResetIntakeForToday, bindIntakeCapture, updateCaptureIntakeStatus] (moved to app/modules/intake-stack/intake/index.js)
    - DATA ACCESS (IndexedDB) -> #SUBMODULES: 2, #@extract: 0, Exports:[initDB, putConf, getConf, addEntry, updateEntry, getAllEntries, getEntryByRemoteId, deleteEntryLocal, dayIsoToMidnightIso]
    - AUTH - Header Cache -> #SUBMODULES: 1, #@extract: 0, Exports:[getHeaders]
    - DATA ACCESS (REST/RPC) -> #SUBMODULES: 30, #@extract: 1, Exports:[deleteRemote, loadIntakeToday, saveIntakeTotals, saveIntakeTotalsRpc, fetchDailyOverview, deleteRemoteDay]
    - APPOINTMENTS -> #SUBMODULES: 0, #@extract: 12, Exports:[refreshAppointments, handleAppointmentSave, handleAppointmentDone, bindAppointmentsPanel, setAppointmentBadge] (moved to assets/js/appointments.js)
    - CAPTURE (Intake) - Status & RPC Hooks -> #SUBMODULES: 0, #@extract: 7, Exports:[clearCaptureIntakeInputs, setCaptureIntakeDisabled, prepareIntakeStatusHeader, updateCaptureIntakeStatus, handleCaptureIntake] (moved to app/modules/intake-stack/intake/index.js)
    - DOCTOR VIEW - Logic -> #SUBMODULES: 3, #@extract: 1, Exports:[renderDoctor, renderDoctorDay, exportDoctorJson] (moved to app/modules/doctor-stack/doctor/index.js)
    - CHARTS (SVG/Canvas) -> #SUBMODULES: 15, #@extract: 3, Exports:[chartPanel]
    - UI / ROUTING / VIEWS - Navigation (Tabs/Resume/Focus) -> #SUBMODULES: 1, #@extract: 1, Exports:[setTab, bindTabs]
    - BP (Blood Pressure) - Validierung -> #SUBMODULES: 0, #@extract: 5, Exports:[requiresBpComment, updateBpCommentWarnings, resetBpPanel] (moved to app/modules/vitals-stack/vitals/bp.js)
    - CAPTURE (Intake) - Panel Resets & Shortcuts -> #SUBMODULES: 0, #@extract: 2, Exports:[resetBodyPanel, resetCapturePanels, addCapturePanelKeys] (moved to app/modules/vitals-stack/vitals/index.js)
    - BP (Blood Pressure) - Persistenz -> #SUBMODULES: 0, #@extract: 6, Exports:[saveBlock, appendNote, allocateNoteTimestamp] (moved to app/modules/vitals-stack/vitals/bp.js)
    - BODY (K√∂rperwerte) -> #SUBMODULES: 0, #@extract: 1, Exports:[resetBodyPanel, saveDaySummary, prefillBodyInputs] (moved to app/modules/vitals-stack/vitals/body.js)
    - DATA ACCESS (Auth Helpers) -> #SUBMODULES: 3, #@extract: 2, Exports:[withRetry, fetchWithAuth, syncWebhook]
    - REALTIME -> #SUBMODULES: 17, #@extract: 8, Exports:[ensureSupabaseClient, setupRealtime, requireDoctorUnlock, resumeFromBackground]
    - FUTURE (placeholders) -> #SUBMODULES: 3, #@extract: 0, Exports:[assistHooks (planned), pwaBootstrap (planned), bleIntegration (planned)]
  total @extract-candidate markers: 18
-->
